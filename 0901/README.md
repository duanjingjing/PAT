# 改写生产者消费者,封装一个车间类(指定缓冲区大小,以及生产者、消费者的数目)

##分析程序框架
>a)Condition内部含有MutexLock的引用。因为多个Condition要与*同一个MutexLock进行交互*。
 b)Buffer是在原生的Queue上面*安装了一层互斥与同步的机制*，从而实现了一个线程安全的缓冲区。
 c)Buffer*包含*了MutexLock和Condition。
 d)两个Thread持有Buffer的引用,是因为*多个线程要与同一个Buffer交互。*
 e)一个类持有另一个类的引用,这叫做*类的关联。*
 f)一个类的数据成员中含有另一个类的对象,这叫做*类的组合*。
 g)Buffer内置了同步于互斥的机制,使得生产者与消费者进程不必关心竞态问题，这使得模块之间的独立性增强,这符合软件工程中"*高耦合,低聚合"*的原则。

###为何以while代替if
a)三个消费者wait在full上。
b)某生产者线程produce数据后调用了broadcast。
c)如果采用if,第一个线程拿到锁,消费完数据后,正常。其余两个线程发生错误。
d)如果采用while,*后面两个线程会再次检测队列的状态。*
e)另外一个错误,生产者还是调用signal。
f)此时一个等待线程被激活后,然后*尚未拿到锁,*另一个线程抢到锁,*直接绕过if语句,*(此时队列不为空),之前的线程拿到锁,继续消费导致错误。
